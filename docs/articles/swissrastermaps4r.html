<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How is this package used? • swissrastermaps4r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How is this package used?">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">swissrastermaps4r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/swissrastermaps4r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>How is this package used?</h1>
            
      
      
      <div class="hidden name"><code>swissrastermaps4r.Rmd</code></div>

    </div>

    
    
<div id="aquire-raster-data" class="section level3">
<h3 class="hasAnchor">
<a href="#aquire-raster-data" class="anchor"></a>Aquire raster data</h3>
<p>First of all, the raster maps need to be acquired and stored in a folder. The package is developed with a focus on <a href="https://shop.swisstopo.admin.ch/de/products/maps/national/digital/">SwissMapRaster</a>, but probably other raster maps will work as well. Currently only <a href="https://epsg.io/2056">CRS 2056</a> is implemented. We might also include <a href="https://epsg.io/21781">CRS 21781</a> at some point but that’s probably it.</p>
<p>The raster maps should be sorted in a folder per scale. Currently, the names of the folders must be as follows: “SMR25” for 1:25’000 maps, “SMR50” for 1:50’000 maps and so on. Rasters should not overlap or have gaps.</p>
</div>
<div id="download-package" class="section level3">
<h3 class="hasAnchor">
<a href="#download-package" class="anchor"></a>Download package</h3>
<p>Download and load the package. It is currently only available on github.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_git</a></span>(<span class="st">"https://github.engineering.zhaw.ch/rata/swissmapraster.git"</span>,<span class="dt">upgrade =</span> F,<span class="dt">quiet =</span> T)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(swissrastermaps4r)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a></code></pre></div>
</div>
<div id="scan-folder" class="section level3">
<h3 class="hasAnchor">
<a href="#scan-folder" class="anchor"></a>Scan Folder</h3>
<p>Next, run the command <code><a href="../reference/init_fdir.html">init_fdir()</a></code> pointing to the location (parent folder) of this maps. This command creates a “File Directory” in the package environment by scanning all folders recursively and analyzing the content. All files ending with “tif” are checked for extent, number of layers and resolution. All the mentioned attributes of each raster file, along with the file path and the extent as a geometry, are stoerd in the variable <code>fdir</code> of the package environment.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/init_fdir.html">init_fdir</a></span>(<span class="st">"C:/Users/rata/Geodata/01_Switzerland/01_Maps"</span>)</a></code></pre></div>
<pre><code>## [1] "Done. 372 Files saved in fdir. Use show_extents() to show their extents."</code></pre>
<p><code>init_fdir</code> stored an <code>sf</code> object in the package’s own environment (called <code>packageEnv</code>). It’s a list of all raster files, stored with their extent, scale, resolution and other information (see <code><a href="../reference/init_fdir.html">init_fdir()</a></code>).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ls">ls</a></span>(<span class="dt">envir =</span> packageEnv)</a></code></pre></div>
<pre><code>## [1] "fdir"</code></pre>
</div>
<div id="show-available-raster-extents" class="section level3">
<h3 class="hasAnchor">
<a href="#show-available-raster-extents" class="anchor"></a>Show available raster extents</h3>
<p>In order to view the available extents, call the function <code><a href="../reference/show_extents.html">show_extents()</a></code>. The default method is <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="../reference/show_extents.html">show_extents</a></span>()</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Use <code>method = "tmap"</code> to show the extents in combination with other spatial data. For example, the <a href="https://opendata.swiss/en/dataset/swissboundaries3d-landesgrenzen">boundary of switzerland</a> is included in the package. Load this dataset with <code><a href="https://www.rdocumentation.org/packages/utils/topics/data">data("landesgebiet")</a></code></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"landesgebiet"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tmap)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="kw">tm_shape</span>(landesgebiet) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="st">   </span><span class="kw">tm_polygons</span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/show_extents.html">show_extents</a></span>(<span class="st">"tmap"</span>)</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="retrieve-single-raster" class="section level3">
<h3 class="hasAnchor">
<a href="#retrieve-single-raster" class="anchor"></a>Retrieve single raster</h3>
<p>Now let’s look at an example where this package actually comes to some use. Say you want to plot a map of the largest cities in Switzerland. There is a sample dataset included in the package with name, location and size of the 10 largest cities in Switzerland.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"gemeinden_top_centroid"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">gemeinden_top_centroid</a></code></pre></div>
<pre><code>## Simple feature collection with 10 features and 2 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 2500063 ymin: 1099230 xmax: 2746142 ymax: 1267460
## epsg (SRID):    2056
## proj4string:    +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs
## # A tibble: 10 x 3
##    NAME        EINWOHNERZ          geometry
##    &lt;chr&gt;            &lt;int&gt;       &lt;POINT [m]&gt;
##  1 Zürich          402762 (2682518 1248416)
##  2 Genève          198979 (2500063 1118118)
##  3 Basel           171017 (2611665 1267460)
##  4 Lausanne        137810 (2540102 1155660)
##  5 Bern            133115 (2597542 1199612)
##  6 Winterthur      109775 (2697619 1261471)
##  7 Luzern           81592 (2664743 1211894)
##  8 St. Gallen       75481 (2746142 1254173)
##  9 Lugano           63932 (2720846 1099230)
## 10 Biel/Bienne      54456 (2586535 1222040)</code></pre>
<p>We can plot a simple map using the sample data already demonstrated:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">tm_shape</span>(landesgebiet) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw">tm_polygons</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw">tm_shape</span>(gemeinden_top_centroid) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">size =</span> <span class="st">"EINWOHNERZ"</span>)</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Now if you would want to include a swiss raster map into this plot you would:</p>
<ol style="list-style-type: decimal">
<li>first decide on a scale</li>
<li>look for the relevant map numbers based on the <a href="https://map.geo.admin.ch/?selectedNode=node_ch.swisstopo.pixelkarte-pk50.metadata1&amp;Y=660000&amp;X=190000&amp;zoom=1&amp;bgLayer=ch.swisstopo.pixelkarte-farbe&amp;layers=ch.swisstopo.pixelkarte-pk50.metadata&amp;time_current=latest&amp;lang=de&amp;topic=ech">division (“Blatteinteilung”)</a>
</li>
<li>find the appropriate raster maps based on the map numbers from the previous step</li>
<li>check raste resolutions and possilby resample all rasters to same resolution</li>
<li>merge all the relevant raster maps into a single file</li>
<li>possilbly reassign <code>CRS</code> and <code>colormap</code>
</li>
<li>import raster into <code>R</code>
</li>
</ol>
<p>This package aims to automate steps 2 - 7 with the function <code><a href="../reference/get_raster.html">get_raster()</a></code>. The function takes an <code>sf</code> object as an input. In addition, scale level (a scale 1:1’000’000 is defined as <code>scale = 1000</code>) and method with which the extent is defined (<code>method =</code>) need to be specified. Currently, two methods are implemented: <code>bbox</code> takes a bounding box while <code>centroid</code> calculates the centroid of the sf object. Both methods accept <code>x_add</code>/<code>y_add</code> with which the extent window is enlarged. Method <code>centroid</code> <em>requires</em> <code>x_add</code>/<code>y_add</code>, since the extent windows would have x/y demensions of Zero.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">rastermap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_raster.html">get_raster</a></span>(<span class="dt">features =</span> landesgebiet,</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">                        <span class="dt">scale_level =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">                        <span class="dt">method =</span> <span class="st">"bbox"</span>, </a>
<a class="sourceLine" id="cb12-4" data-line-number="4">                        <span class="dt">name =</span> <span class="st">"relief"</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw">tm_shape</span>(rastermap) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">  </span><span class="kw">tm_rgb</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="st">  </span><span class="kw">tm_shape</span>(gemeinden_top_centroid) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">size =</span> <span class="st">"EINWOHNERZ"</span>)</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div id="retrieve-multiple-rasters" class="section level3">
<h3 class="hasAnchor">
<a href="#retrieve-multiple-rasters" class="anchor"></a>Retrieve multiple rasters</h3>
<p>In the previouse example, little was gained using the <code>get_raster</code> function. The function get’s much more useful when multiple raster are needed. Using the same dataset, we can get a raster <em>per city</em> using the option <code>per_feature = T</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">rastermap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_raster.html">get_raster</a></span>(<span class="dt">features =</span> gemeinden_top_centroid,</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">                        <span class="dt">x_add =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">                        <span class="dt">y_add =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">                        <span class="dt">per_feature =</span> T,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">                        <span class="dt">scale_level =</span> <span class="dv">25</span>,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">                        <span class="dt">method =</span> <span class="st">"centroid"</span>,</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">                        <span class="dt">limit =</span> <span class="dv">4</span>)</a></code></pre></div>
<p>If multiple rasters are returned, the output is a <code><a href="https://www.rdocumentation.org/packages/base/topics/list">list()</a></code> of rasters with a length corresponding to the number of featuers (i.e. rows) in the input features. To access the first map in the list, we use the double parenthese <code>[[]]</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">tm_shape</span>(rastermap[[<span class="dv">1</span>]]) <span class="op">+</span><span class="st"> </span><span class="kw">tm_rgb</span>()</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>We can of course now add all of our vector data stored in the input feature. To keep things simple, we’ll refrain from doing this in this example. Just one last thing: Having the maps in lists lets us wield the power of <code>purrr</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">map</span>(rastermap,<span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="kw">tm_shape</span>(x) <span class="op">+</span><span class="st"> </span><span class="kw">tm_rgb</span>()</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">}) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">  </span><span class="kw">tmap_arrange</span>(<span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nils Ratnaweera.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
