<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How is this package used? • swissrastermaps4r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How is this package used?">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">swissrastermaps4r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/swissrastermaps4r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/showcasing.html">Showcasing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/swissgeodata4r/swissrastermaps4r">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>How is this package used?</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/swissgeodata4r/swissrastermaps4r/blob/master/vignettes/swissrastermaps4r.Rmd"><code>vignettes/swissrastermaps4r.Rmd</code></a></small>
      <div class="hidden name"><code>swissrastermaps4r.Rmd</code></div>

    </div>

    
    
<div id="important-notice" class="section level3">
<h3 class="hasAnchor">
<a href="#important-notice" class="anchor"></a>Important notice</h3>
<p>I’m currently the only one using this package. Things break freaquently and there is absolutly no backwards compatibility. Please tell me if you are planing to use this package so I will take greater care!</p>
</div>
<div id="aquire-raster-data" class="section level3">
<h3 class="hasAnchor">
<a href="#aquire-raster-data" class="anchor"></a>Aquire raster data</h3>
<p>In a firs step, the raster maps need to be acquired and stored in a folder. Unfortunately, most of the swisstopo raster maps are behind a paywall if you aren’t part of <a href="https://geodata4edu.ch/">geodata4edu</a>. Two scales are available publicly for free (see #1):</p>
<ul>
<li><a href="https://shop.swisstopo.admin.ch/en/products/maps/national/digital/srm500">1:500’000</a></li>
<li><a href="https://shop.swisstopo.admin.ch/en/products/maps/national/digital/srm1000">1:100’000</a></li>
</ul>
<p>The package is developed with a strong focus on the <a href="https://shop.swisstopo.admin.ch/de/products/maps/national/digital/">swisstopo</a> raster maps and hasn’t been tested with other data. Therefore, only <a href="https://epsg.io/2056">CRS 2056</a> and <a href="https://epsg.io/21781">CRS 21781</a> are implemented.</p>
</div>
<div id="data-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#data-structure" class="anchor"></a>Data structure</h3>
<p>Create one folder for each maptype, scale and projection. Each folder is then named <code>MAPTYPE_SCALE_PROJECTION</code> (e.g. <code>PK_25_2056</code>). Check the function <code>fdir_init</code> to get more details on the requirements for naming the folders.</p>
<p>Some metadata must be derived from the filename. In order to achieve this, create a text file in each folder and change the file name of that textfile to match the naming pattern on the files within the folder. For example, the 1:500’000 raster map has the filename: ‘PK500_LV95_KGRS_500_2016_1.tif’. The filestructure and the corresponding “.pattern”-File should therefore look as follows:</p>
<pre><code>Geodata/
├── PK_500_2056/
│   ├── PK500_LV95_KGRS_500_2016_1.tif
│   ├── AABBB_CCCC_DDDD_EEE_FFFF_G.pattern</code></pre>
<p>Call <code><a href="../reference/search_pattern.html">search_pattern()</a></code> to see the associated naming schema (i.e. the placeholders and their meanings). The function <code>metainfo_from_filename</code> is called on the filenames.</p>
<p><strong>Note:</strong></p>
<ul>
<li>The character length of the naming pattern <em>must</em> match the length of the filename. In this way, different naming patterns can exist within a single folder.</li>
<li>The naming pattern currently can’t handle variable lenghts</li>
</ul>
</div>
<div id="download-package" class="section level3">
<h3 class="hasAnchor">
<a href="#download-package" class="anchor"></a>Download package</h3>
<p>Download and load the package. It is currently only available on github.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"swissgeodata4r/swissrastermaps4r"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(swissrastermaps4r)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a></code></pre></div>
</div>
<div id="scan-folder" class="section level3">
<h3 class="hasAnchor">
<a href="#scan-folder" class="anchor"></a>Scan Folder</h3>
<p>Next, run the command <code><a href="../reference/fdir_init.html">fdir_init()</a></code> pointing to the location (parent folder) of these maps. This command creates a “File Directory” in the package environment by scanning all folders recursively and analyzing the content. All files ending with “tif” are checked for extent, number of layers and resolution. All the mentioned attributes of each raster file, along with the file path and the extent as a geometry, are stored in the variable <code>fdir</code> of the package environment.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/fdir_init.html">fdir_init</a></span>(<span class="st">"C:/Users/rata/Geodata/01_Switzerland/01_Maps"</span>,<span class="dt">add_geometry =</span> F)</a></code></pre></div>
<p><code>fdir_init</code> stored an <code>sf</code> object in the package’s own environment (called <code>packageEnv</code>). It’s a list of all raster files, stored with their extent, scale, resolution and other information (see <code><a href="../reference/fdir_init.html">fdir_init()</a></code>).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ls">ls</a></span>(<span class="dt">envir =</span> swissrastermapEnv)</a></code></pre></div>
<pre><code>## [1] "fdir"                "search_pattern_dict"</code></pre>
</div>
<div id="retrieve-single-raster" class="section level3">
<h3 class="hasAnchor">
<a href="#retrieve-single-raster" class="anchor"></a>Retrieve single raster</h3>
<p>Now let’s look at an example where this package actually comes to some use. Say you want to plot a map of the largest cities in Switzerland. There is a sample dataset included in the package with name, location and size of the 10 largest cities in Switzerland.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"sample_points"</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"switzerland"</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">sample_points</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    NAME        EINWOHNERZ geometry
##    &lt;chr&gt;            &lt;int&gt; &lt;list&gt;  
##  1 Zürich          402762 &lt;S3: XY&gt;
##  2 Genève          198979 &lt;S3: XY&gt;
##  3 Basel           171017 &lt;S3: XY&gt;
##  4 Lausanne        137810 &lt;S3: XY&gt;
##  5 Bern            133115 &lt;S3: XY&gt;
##  6 Winterthur      109775 &lt;S3: XY&gt;
##  7 Luzern           81592 &lt;S3: XY&gt;
##  8 St. Gallen       75481 &lt;S3: XY&gt;
##  9 Lugano           63932 &lt;S3: XY&gt;
## 10 Biel/Bienne      54456 &lt;S3: XY&gt;</code></pre>
<p>We can plot a simple map using the sample data already demonstrated:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tmap)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">tm_shape</span>(switzerland) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw">tm_polygons</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw">tm_shape</span>(sample_points) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">size =</span> <span class="st">"EINWOHNERZ"</span>)</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Now if you would want to include a swiss raster map into this plot you would:</p>
<ol style="list-style-type: decimal">
<li>first decide on a scale</li>
<li>look for the relevant map numbers based on the <a href="https://map.geo.admin.ch/?selectedNode=node_ch.swisstopo.pixelkarte-pk50.metadata1&amp;Y=660000&amp;X=190000&amp;zoom=1&amp;bgLayer=ch.swisstopo.pixelkarte-farbe&amp;layers=ch.swisstopo.pixelkarte-pk50.metadata&amp;time_current=latest&amp;lang=de&amp;topic=ech">division (“Blatteinteilung”)</a>
</li>
<li>find the appropriate raster map <em>files</em> based on the map numbers from the previous step</li>
<li>import raster into <code>R</code>
</li>
<li>check raster resolutions and possibly resample all rasters to same resolution</li>
<li>merge all the relevant raster maps into a single file</li>
<li>possilbly reassign <code>CRS</code> and <code>colormap</code>
</li>
</ol>
<p>This package automates steps 2 - 7 with the function <code><a href="../reference/get_raster.html">get_raster()</a></code>. The function takes an <code>sf</code> object as an input. In addition, scale level (a scale 1:1’000’000 is defined as <code>scale = 1000</code>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">rastermap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_raster.html">get_raster</a></span>(<span class="dt">features =</span> switzerland,</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">                        <span class="dt">name =</span> <span class="st">"relief"</span>)</a></code></pre></div>
<pre><code>## Using scale level:  1000</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">tm_shape</span>(rastermap) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">tm_rgb</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw">tm_shape</span>(sample_points) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">size =</span> <span class="st">"EINWOHNERZ"</span>)</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="retrieve-multiple-rasters" class="section level3">
<h3 class="hasAnchor">
<a href="#retrieve-multiple-rasters" class="anchor"></a>Retrieve multiple rasters</h3>
<p>In the previous example, little was gained using the <code>get_raster</code> function. The function get’s much more useful when multiple raster are needed.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">rastermap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_raster.html">get_raster</a></span>(sample_points[<span class="dv">1</span>,],<span class="dt">x_add =</span> <span class="dv">1000</span>,<span class="dt">y_add =</span> <span class="dv">1000</span>)</a></code></pre></div>
<pre><code>## Using scale level:  25</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">credits &lt;-<span class="st"> "Geodata \u00A9 Swisstopo"</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">tm_shape</span>(rastermap) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span><span class="kw">tm_raster</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="st">  </span><span class="kw">tm_credits</span>(credits,<span class="dt">bg.color =</span> <span class="st">"white"</span>,<span class="dt">bg.alpha =</span> <span class="fl">0.8</span>)</a></code></pre></div>
<p><img src="swissrastermaps4r_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nils Ratnaweera.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
