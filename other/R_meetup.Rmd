---
title: "Swiss Geodata 4 R"
subtitle: "Easy Access to Raster and Vector data from within R"
author: "Nils Ratnaweera"
date: "2018/12/05 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(warning = F,message = F)
```

Easy << --- >> hard

- Vector data << --- >> Raster data
- Open data << --- >> Custom data (swisstopo)
- single map << --- >> map series
- whole extent << --- >> custom extent
- single map tile << --- >> multiple map tiles
- single resolution <<--- >> multiple resolutions

---

## Load necessary libraries

```{r}

library(tmap,quietly = T)
library(sf,quietly = T)
library(raster,quietly = T)

library(swissboundriesR)

data("landesgebiet")

library(tidyverse)
```
---
## Create a chloropleth map in `R`

This has become very easy with the new packages `sf`and `tmap`:

```{r}
tm_shape(landesgebiet) + tm_sf(col = "NAME")
```
---

## Use open raster basemaps

This is still very easy, especially when working with interactive maps

```{r, include=FALSE}
landesgebiet <- st_zm(landesgebiet)
```


```{r}
tmap_mode("view")
tm_shape(landesgebiet) + tm_sf(col = "NAME") + tm_basemap()
```
---

## Use Swisstopo basemap

Also fairly easy, if the map only includes a single file and it is clear which one this is:

```{r,include=F}
tmap_mode("plot")

switzerland<- raster::brick("C:/Users/rata/Geodata/01_Switzerland/01_Maps/PK_1000_2056_relief/1mio_relief.tif")
raster::crs(switzerland) <- sp::CRS("+init=EPSG:2056")

```


```{r}
tm_shape(switzerland) + 
  tm_rgb() +
  tm_shape(landesgebiet,is.master = T) + 
  tm_sf(col = "NAME", alpha = 0.3)
```

---
```{r,include=F}
data("gemeinden_top_poly")
zuerich <- gemeinden_top_poly[gemeinden_top_poly$NAME == "ZÃ¼rich",]
```

## Use Swisstopo basemap (II)

What if we want to plot Zurich only? Using the 1:1'000'000 Map from before will not do:
```{r}
tm_shape(switzerland) + 
  tm_rgb() +
  tm_shape(zuerich,is.master = T) + 
  tm_sf(col = "NAME", alpha = 0.3)
```

---

## Use Swisstopo basemap (III)


Using a custom raster map is cumbersome. We have to follow the following steps:

--

1. first decide on a scale

--

2. look for the relevant map numbers based on the division (â€œBlatteinteilungâ€)

--

3. find the appropriate raster maps based on the map numbers from the previous step

--

4. check raster resolutions and possibly resample all rasters to same resolution

--

5. merge all the relevant raster maps into a single file

--

6. possibly reassign CRS and colormap

--

7. import raster into R

--

8. finally: plot data

--

--> This is where `swissrastermaps4r` comes in. It is a package that tries to automate steps 2 - 7
---

## Use Swisstopo basemap (III)


Using a custom raster map is cumbersome. We have to follow the following steps:

1. first decide on a scale

2. ~~look for the relevant map numbers based on the division (â€œBlatteinteilungâ€)~~

3. ~~find the appropriate raster maps based on the map numbers from the previous step~~

4. ~~check raster resolutions and possibly resample all rasters to same resolution~~

5. ~~merge all the relevant raster maps into a single file~~

6. ~~possibly reassign CRS and colormap~~

7. ~~import raster into R~~

8. finally: plot data

--> This is where `swissrastermaps4r` comes in. It is a package that tries to automate steps 2 - 7
---

## swissrastermaps4r


```{r}
{{library(swissrastermaps4r)}}

```

--

```{r}
init_fdir("C:/Users/rata/Geodata/01_Switzerland/01_Maps")
```

--

```{r}
{{zuerich_raster <- get_raster(zuerich,scale_level = 100,method = "bbox")}}
```


---

## swissrastermaps4r (I)
```{r}
tm_shape({{zuerich_raster}}) + 
  tm_rgb() +
  tm_shape(zuerich,is.master = T) + 
  tm_borders(col = "red",lwd = 3)
```


---
## swissrastermaps4r (II)

Want to join? I'm looking for people who would like to simplify access for swiss raster maps in R because:

--

- they want to use swiss raster maps in R themselves _and / or_

--

- want to learn package development (I am a novice myself) _and / or_

--

- they have connections to swisstopo and/or geodata4edu _and / or_

--
- they have too much spare time ðŸ˜„

--

## It's on Github! 

[https://github.engineering.zhaw.ch/rata/swissmapraster](https://github.engineering.zhaw.ch/rata/swissmapraster)

--

Openly accessible on the ZHAW github, I can easily move it to github.com
